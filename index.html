<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的导航</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <header></header>
    <main>
        <div class="wrapper" id="main1">

        </div>
    </main>
    <footer></footer>
</body>
<script>
    //1.初始化数据
    var hashA = init()
    var keys = hashA['keys']
    var hash = hashA['hash']

    //2.生成键盘
    //遍历keys 生成kbd
    generateKeyboard(keys, hash)

    //3.监听用户动作
    listenToUser(hash)

    // 下面是工具函数
    function getFromLocalStorage(name) {
        return JSON.parse(localStorage.getItem(name) || 'null')
    }

    function tag(tagName) {
        return document.createElement(tagName)
    }

    function createSpan(textContent) {
        var span = tag('span')
        span.textContent = textContent
        span.className = 'text'
        return span
    }

    function createButton(id) {
        var button = tag('button')
        button.textContent = '编辑'
        button.id = id
        button.onclick = function (keyboard) {
            //keyboard就是用户点击的元素
            var button2 = keyboard.target
            var img2 = button2.previousSibling
            var key = button2.id
            var x = prompt('给我一个网址：')
            hash[key] = x
            img2.src = 'http://' + x + '/favicon.ico'
            img2.onerror = function (xxx) {
                xxx.target.src = './wu.jpg'
            }
            localStorage.setItem('zzz', JSON.stringify(hash))
        }
        return button
    }

    function createImage(domain) {
        var img = tag('img')
        if (domain) {
            img.src = 'http://' + domain + '/favicon.ico'
        } else {
            img.src = './wu.jpg'
        }
        img.onerror = function (xxx) {
            xxx.target.src = './wu.jpg'
        }
        return img
    }

    function init() {
        var keys = {
            0: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
            1: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
            2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
            length: 3
        }
        var hash = {
            'q': 'qq.com',
            'w': 'weibo.com',
            'e': 'ele.me',
            'r': 'renren.com',
            't': 'tencent.com',
            'y': 'youku.com',
            'u': 'uc.com',
            'i': 'iqiyi.com',
            'o': 'opera.com',
            'z': 'zhihu.com'
        }
        //取出 localStorage 中的 zzz 对象的 hash
        var hashInLocalStorage = getFromLocalStorage('zzz')
        if (hashInLocalStorage) {
            hash = hashInLocalStorage
        }
        return {
            "keys": keys,
            "hash": hash
        }
    }

    function generateKeyboard(keys, hash) {
        for (var index = 0; index < keys['length']; index++) {
            var div1 = tag('div')
            div1.className = 'row'

            main1.appendChild(div1)

            var row = keys[index]
            for (var index2 = 0; index2 < row['length']; index2++) {
                var span1 = createSpan(row[index2])

                var buttonX = createButton(row[index2])

                var img1 = createImage(hash[row[index2]])

                var kbd1 = tag('kbd')
                kbd1.className = 'key'

                kbd1.appendChild(span1)
                kbd1.appendChild(img1)
                kbd1.appendChild(buttonX)
                div1.appendChild(kbd1)
            }
        }
    }

    function listenToUser(hash) {
        document.onkeypress = function (keyboard) {
            var key = keyboard['key']
            var website = hash[key]
            window.open('http://www.' + website, '_blank')
        }
    }
</script>

</html>